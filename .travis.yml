language: node_js
node_js:
- '10'
cache: npm
jobs:
  include:
    - stage: Install
      script:
        - npm install -g @angular/cli
    - stage: Tests
      script:
        - ng lint
        - ng test --code-coverage=true --no-watch --no-progress --browsers ChromeHeadlessCI
    - stage: Update
      script:
        - branch=$(git branch | sed -n -e 's/^\* \(.*\)/\1/p');
        - echo $branch;
        - if [ $TRAVIS_BRANCH = "master" ]; then npm version minor; fi;
        - if [ $TRAVIS_BRANCH != "master" ] & [ $TRAVIS_PULL_REQUEST = "true" ]; then npm version patch; fi;
        - git push -f https://$GH_USER:$GH_TOKEN@github.com/$GH_USER/epam-angular-mentoring HEAD:$branch;
    - stage: Publish
      script:
        - npm install -g firebase-tools;
        - if [ $TRAVIS_BRANCH = "master" ]; then firebase deploy --token $APP_TOKEN;
