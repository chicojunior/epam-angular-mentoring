language: node_js
node_js:
- '10'
cache: npm
jobs:
  include:
    - stage: install
      script:
        - npm install -g @angular/cli
    - stage: test
      script:
        - ng lint
        - ng test --code-coverage=true --no-watch --no-progress --browsers ChromeHeadlessCI
    - stage: deploy
      script:
        - npm install -g firebase-tools
        - ng build --prod
        - npm version patch
        - git add .
        - git commit -m "version update"
        - git push origin master
        - firebase deploy --token "$APP_TOKEN"
stages:
  - name: install
  - name: test
  - name: deploy
    if: branch = master
